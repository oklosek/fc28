# config/settings.yaml - centralna konfiguracja systemu
control:
  controller_loop_s: 1
  scheduler_loop_s: 1
  target_temp_c: 25
  humidity_thr: 70
  wind_risk_ms: 10
  wind_crit_ms: 20
  rain_threshold: 0.5
  risk_open_limit_percent: 50
  min_open_hum_percent: 20
  crit_hum_crack_percent: 10
  co2_thr_ppm: 1200
  min_open_co2_percent: 25
  wind_lock_enabled: true
  day_target_temp_c: 25
  night_target_temp_c: 20
  day_start: "06:00"
  night_start: "20:00"
  night_max_open_percent: 40
  flush_hour: 12
  calibration_hour: 0
  allow_humidity_override: false
  temp_diff_percent: 5
  step_percent: 10
  step_delay_s: 10
  group_delay_s: 5

sensor_avg_window_s: 5

# Dwie magistrale RS485: wewnetrzna i zewnetrzna
rs485_buses:
  - name: "internal_bus"
    port: "/dev/ttyUSB0"
    baudrate: 9600
    timeout: 0.2
    sensors:
      - driver: "sensecap_sco2_03b"
        slave: 45
        outputs:
          co2: "internal_co2"
          temperature: "internal_temp"
          humidity: "internal_hum"
  - name: "external_bus"
    port: "/dev/ttyUSB1"
    baudrate: 9600
    timeout: 0.2
    sensors:
      - driver: "sensecap_s500_v2"
        slave: 10
        outputs:
          air_temperature: "external_temp"
          air_humidity: "external_hum"
          barometric_pressure: "external_pressure"
          wind_direction_avg: "wind_direction"
          wind_speed_avg: "wind_speed"
          wind_speed_max: "wind_gust"

# Mapowanie czujnikow publikowanych po MQTT (jesli BoneIO publikuje)
sensors:
  internal_temp:
    topic: "farmcare/sensors/internalTemp"
    avg_window_s: 5
  internal_hum:
    topic: "farmcare/sensors/internalHumidity"
    avg_window_s: 5
  internal_co2:
    avg_window_s: 5
  external_temp:
    topic: "farmcare/sensors/externalTemp"
    avg_window_s: 7
  external_hum:
    avg_window_s: 7
  external_pressure:
    avg_window_s: 7
  wind_speed:
    topic: "farmcare/sensors/windSpeed"
  wind_gust:
    avg_window_s: 5
  wind_direction:
    avg_window_s: 5
  rain:
    topic: "farmcare/sensors/rain"
# Urzadzenia BONEIO (ESPHome) - nazwy logiczne
boneio_devices:
  - id: "boneio_main"
    base_topic: "boneio/1"



# Domyslne parametry dzialania wietrznikow
vent_defaults:
  reverse_pause_s: 1.0
  min_move_s: 0.5
  calibration_buffer_s: 0.5
  ignore_delta_percent: 0.5

# Wietrzniki - dynamicznie; kazdy ma kanaly UP/DOWN na danym BONEIO
# Oddzielne wejscia bledu (IN1, IN3, IN5, ...) - tu jako topic 'error_in'
vents:
  - id: 1
    name: "Dach 1"
    boneio_device: "boneio_main"
    travel_time_s: 30
    topics:
      up:   "boneio/1/cover/vent1/up"
      down: "boneio/1/cover/vent1/down"
      error_in: "boneio/1/in/vent1_error"   # IN1
  - id: 2
    name: "Dach 2"
    boneio_device: "boneio_main"
    travel_time_s: 28
    topics:
      up:   "boneio/1/cover/vent2/up"
      down: "boneio/1/cover/vent2/down"
      error_in: "boneio/1/in/vent2_error"   # IN3
  - id: 3
    name: "Bok 1"
    boneio_device: "boneio_main"
    travel_time_s: 35
    topics:
      up:   "boneio/1/cover/vent3/up"
      down: "boneio/1/cover/vent3/down"
      error_in: "boneio/1/in/vent3_error"   # IN5
  - id: 4
    name: "Dach 3"
    boneio_device: "boneio_main"
    travel_time_s: 32
    topics:
      up:   "boneio/1/cover/vent4/up"
      down: "boneio/1/cover/vent4/down"
      error_in: "boneio/1/in/vent4_error"   # IN7
  # ... dodawaj kolejne - system skalowalny

# Definicje grup: przypisanie wietrznikow do grup logicznych
vent_groups:
  - id: "group_1"
    name: "Dach 1+2"
    vents: [1, 2]
    wind_upwind_deg:
      - [300, 60]
    wind_lock_enabled: true
    wind_lock_close_percent: 0
  - id: "group_2"
    name: "Bok 1"
    vents: [3]
    wind_upwind_deg:
      - [180, 270]
    wind_lock_enabled: true
    wind_lock_close_percent: 0
  - id: "group_3"
    name: "Dach 3"
    vents: [4]
    wind_upwind_deg:
      - [240, 330]
    wind_lock_enabled: true
    wind_lock_close_percent: 0

# Harmonogram otwierania: etapy (parallel/serial) z krokiem i kolejnoscia
vent_plan:
  close_strategy: 0  # 0=fifo, 1=lifo
  stages:
    - id: "stage_1"
      name: "Dach + Bok"
      mode: "parallel"
      step_percent: 25
      groups: ["group_1", "group_2"]
    - id: "stage_2"
      name: "Dach 3"
      mode: "serial"
      step_percent: 100
      groups: ["group_3"]
      delay_s: 2


heating:
  enabled: false
  topic: "boneio/1/switch/heating"
  payload_on: "ON"
  payload_off: "OFF"
  day_target_c: 20
  night_target_c: 16
  hysteresis_c: 5
  day_start: "06:00"
  night_start: "20:00"

network_interfaces:
  lan:
    name: "eth0"
    description: "Interfejs LAN (most do sieci lokalnej)"
  wan:
    name: "wlan0"
    description: "Interfejs WAN / uplink"


security:
  require_token: true     # WAN wymaga naglowka x-admin-token
# Aktualizacje systemu
updates:
  enabled: false
  manifest_url: ""
  check_interval_hours: 24
  apply_script: "scripts/update_from_zip.sh"
  channel: "stable"


